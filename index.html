<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />
  <title>Nauka niemieckiego ‚Äì magazyn / logistyka</title>

  <!-- Anti-FOUC: ustaw jasny motyw zanim wczyta siƒô CSS/DOM -->
  <script>
    (function(){
      try{
        var t = localStorage.getItem("tool_theme_v1") || "dark";
        if(t==="light"){ document.documentElement.classList.add("pre-light"); }
      }catch(e){}
    })();
  </script>

  <style>
    /* ===== Motyw domy≈õlny (ciemny) ===== */
    :root{
      --bg:#0b1220; --panel:#121a2b; --card:#16233a; --muted:#90a3b3; --text:#e7eef6;
      --accent:#6fd1ff; --ok:#2ecc71; --warn:#f39c12; --danger:#e74c3c;
      --border:#20304e; --border-soft:#253a5d; --chip:#0e1a2e; --chip-ink:#aac0d6; --input:#0f1b2f;
    }
    /* Wczesne ustawienie jasnego motywu (z <head>) */
    .pre-light{
      --bg:#ffffff; --panel:#ffffffee; --card:#fffaf7; --muted:#5b6570; --text:#0e1320;
      --accent:#0077ff; --ok:#1e9e55; --warn:#b0760c; --danger:#c43b30;
      --border:#e5e7eb; --border-soft:#e8eaee; --chip:#f6f7fb; --chip-ink:#6b7280; --input:#ffffff;
    }

    *{box-sizing:border-box}
    html, body { height: 100%; }
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg),var(--bg) 60%,#0e1628);
      color:var(--text);
      -webkit-tap-highlight-color: transparent;
      display:flex; flex-direction:column;
    }
    /* Aktywacja jasnego motywu po za≈Çadowaniu (to samo co .pre-light, ale na body) */
    body.theme-light{
      --bg:#ffffff; --panel:#ffffffee; --card:#fffaf7; --muted:#5b6570; --text:#0e1320;
      --accent:#0077ff; --ok:#1e9e55; --warn:#b0760c; --danger:#c43b30;
      --border:#e5e7eb; --border-soft:#e8eaee; --chip:#f6f7fb; --chip-ink:#6b7280; --input:#ffffff;
      background:linear-gradient(180deg,#f7f9fc,#ffffff 60%,#f7f9fc);
    }

    header{
      position:sticky;top:0;z-index:10;
      background:var(--panel);
      backdrop-filter:blur(8px);
      border-bottom:1px solid var(--border);
      padding-top: env(safe-area-inset-top);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px;}
    h1{margin:6px 0 2px 0;font-size:22px}
    .sub{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.2)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap; align-items:center}
    button,select,input[type="text"],input[type="number"]{
      border-radius:12px;border:1px solid var(--border);background:var(--input);color:var(--text);padding:10px 12px;font-size:14px
    }
    button{cursor:pointer;transition:.2s ease; touch-action: manipulation;}
    button:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.25)}
    button:active{transform:none; box-shadow:none; filter:brightness(1.08);}
    .accent{border-color:#2a5775;background:#11344a}
    .accent:hover{background:#0f2b3d}
    .good{border-color:#1f5f3a;background:#123022}
    .warn{border-color:#6b4a13;background:#1e1609}
    .danger{border-color:#6b2323;background:#2b1212}

    /* Jasne warianty ‚Äûstanowych‚Äù */
    body.theme-light .accent{background:#eaf3ff;border-color:#bdd7ff}
    body.theme-light .good{background:#e7f7ee;border-color:#bae8cc}
    body.theme-light .warn{background:#fff7e8;border-color:#ffe1a6}
    body.theme-light .danger{background:#ffefef;border-color:#ffd2cf}

    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--border-soft);color:var(--muted);font-size:12px}
    .kpi{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
    .kpi .pill strong{color:var(--text)}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .fc{font-size:54px;text-align:center;margin:16px 0;word-break:break-word}
    .big{font-size:20px}
    .muted{color:var(--muted)}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
    .choice{padding:12px;border-radius:12px;border:1px solid #2a3c60;background:#0f1930;cursor:pointer}
    .choice.correct{border-color:#246b47;background:#122b21}
    .choice.wrong{border-color:#6b2424;background:#2b1212}
    body.theme-light .choice{background:#ffffff;border-color:var(--border)}
    body.theme-light .choice.correct{background:#e7f7ee;border-color:#bae8cc}
    body.theme-light .choice.wrong{background:#ffefef;border-color:#ffd2cf}

    .hidden{display:none}
    .small{font-size:12px;color:var(--muted)}
    footer{opacity:.7;font-size:12px;margin-top:18px}
    .tag{display:inline-block;padding:4px 8px;border:1px solid var(--border-soft);border-radius:999px;margin-right:6px;margin-top:6px}
    .section-title{margin:16px 0 8px 0;font-size:14px;text-transform:uppercase;color:var(--chip-ink);letter-spacing:.06em}
    .summary{background:var(--chip);border:1px solid var(--border-soft);border-radius:12px;padding:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{font-size:12px;border-bottom:1px solid var(--border-soft);padding:6px 8px;text-align:left}

    main.wrap { flex: 1; }

    .site-footer{
      background: var(--panel);
      border-top: 1px solid var(--border);
      backdrop-filter: blur(8px);
      padding: 14px 0 max(14px, env(safe-area-inset-bottom));
      color: var(--muted);
      font-size: 13px;
      opacity: 1 !important;
      margin-top: 0;
    }
    .site-footer .inner{
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
    }
    .site-footer .left{ color: var(--muted); }
    .site-footer .right a{
      color: var(--text);
      text-decoration: none;
      border: 1px solid var(--border-soft);
      padding: 6px 10px;
      border-radius: 999px;
      transition: .2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .site-footer .right a:hover{
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      background: var(--chip);
    }
    .site-footer .right svg{ width: 16px; height: 16px; flex: 0 0 auto; }

    /* ===== Segment (pigu≈Çki) Jasny/Ciemny ===== */
    .segment{
      display:inline-flex; background:var(--chip); border:1px solid var(--border-soft);
      border-radius:999px; padding:4px; gap:4px;
    }
    .segment input{ position:absolute; opacity:0; pointer-events:none; }
    .segment label{
      user-select:none; cursor:pointer; padding:6px 10px; border-radius:999px; font-size:12px; color:var(--muted);
      display:inline-flex; align-items:center; gap:6px; border:1px solid transparent; transition:.15s ease;
    }
    .segment input:checked + label{
      color:var(--text); background:var(--card); border-color:var(--border-soft); box-shadow:0 2px 8px rgba(0,0,0,.08);
      transform:translateY(-1px);
    }

    /* RESPONSYWNO≈öƒÜ */
    @media (max-width: 980px){
      .wrap{padding:12px}
      .grid{grid-template-columns:1fr}
      .choices{grid-template-columns:1fr}
      .row{flex-direction:column}
      .toolbar{
        overflow:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px; gap:8px;
      }
      .toolbar > *{ flex:0 0 auto; min-width: 160px }
      button, select, input[type="text"], input[type="number"]{ width:100% }
      .fc{font-size:44px}
      #list{ max-height:40vh !important }
    }
    @media (max-width: 640px){
      h1{font-size:20px}
      .sub{font-size:12px}
      .fc{font-size:36px}
      .big{font-size:18px}
      .pill{font-size:11px}
      .table th,.table td{font-size:11px}
      .wrap{padding:10px}
      .toolbar > *{ min-width: unset }
    }
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important; animation:none !important}
    }
    #list .tag{display:block; line-height:1.4; padding:8px 10px;}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Niemiecki dla magazynu / logistyki</h1>
      <div class="sub">Fiszki, quiz, <strong>PL‚ÜîDE</strong>, test i statystyki (LocalStorage).</div>
    </div>
  </header>

  <main class="wrap" style="padding-top:12px">
    <div class="grid">
      <section class="card">
        <div class="toolbar" role="group" aria-label="Tryby i ustawienia">

          <!-- ‚Äî‚Äî PRZE≈ÅƒÑCZNIK MOTYWU (pigu≈Çki) ‚Äî‚Äî -->
          <div class="segment" role="tablist" aria-label="Motyw">
            <input type="radio" name="theme" id="theme-light" value="light" aria-label="Jasny">
            <label for="theme-light">Jasny</label>
            <input type="radio" name="theme" id="theme-dark" value="dark" aria-label="Ciemny">
            <label for="theme-dark">Ciemny</label>
          </div>

          <button id="mode-flash" class="accent">Tryb: Fiszki</button>
          <button id="mode-quiz">Tryb: Quiz (ABC)</button>
          <button id="mode-exam" class="warn">Test egzaminacyjny</button>
          <select id="direction" aria-label="Kierunek nauki">
            <option value="EN2PL">Kierunek: DE ‚Üí PL</option>
            <option value="PL2EN">Kierunek: PL ‚Üí DE</option>
            <option value="MIX">Kierunek: MIX</option>
          </select>
          <button id="shuffle" title="Wymieszaj">Wymieszaj</button>
          <button id="reset" class="good" title="Zeruj postƒôp">Zeruj postƒôp</button>

          <!-- ‚Äî‚Äî PE≈ÅNY EKRAN ‚Äî‚Äî -->
          <button id="fullscreen" title="Pe≈Çny ekran">Pe≈Çny ekran</button>
        </div>

        <div class="kpi" aria-live="polite">
          <div class="pill">Nauczone: <strong id="stat-known">0</strong></div>
          <div class="pill">Do nauki: <strong id="stat-left">0</strong></div>
          <div class="pill">Skuteczno≈õƒá (quiz): <strong id="stat-acc">0%</strong></div>
          <div class="pill">Dzi≈õ: <strong id="stat-today">0</strong></div>
          <div class="pill">Ostatnie 7 dni: <strong id="stat-week">0</strong></div>
        </div>

        <!-- FLASHCARDS -->
        <div id="flashcards">
          <div class="fc" id="card-word">‚Äî</div>
          <div class="row">
            <button id="show-translation" class="accent">Poka≈º t≈Çumaczenie</button>
            <button id="toggle-sentence">Poka≈º wskaz√≥wkƒô</button>
            <button id="mark-known" class="good">Znam to</button>
          </div>
          <div class="big muted" id="card-translation" style="margin-top:10px" aria-live="polite">&nbsp;</div>
          <div class="small" id="card-example" style="margin-top:8px" aria-live="polite">&nbsp;</div>
        </div>

        <!-- QUIZ -->
        <div id="quiz" class="hidden">
          <div class="big" id="quiz-q">&nbsp;</div>
          <div class="choices" id="quiz-choices"></div>
          <div class="small" id="quiz-feedback" style="margin-top:8px" aria-live="polite"></div>
        </div>

        <!-- EXAM -->
        <div id="exam" class="hidden">
          <div class="section-title">Ustawienia testu</div>
          <div class="row" style="margin-bottom:8px">
            <label style="flex:1">Liczba pyta≈Ñ <input id="exam-count" type="number" min="5" max="50" value="10" style="width:100%"></label>
            <label style="flex:1">
              Kierunek
              <select id="exam-direction" style="width:100%">
                <option value="EN2PL">DE ‚Üí PL</option>
                <option value="PL2EN">PL ‚Üí DE</option>
                <option value="MIX" selected>MIX</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button id="exam-start" class="accent">Start testu</button>
            <button id="exam-cancel" class="danger hidden">Przerwij</button>
          </div>
          <div id="exam-area" class="hidden" style="margin-top:12px">
            <div class="big" id="exam-q">&nbsp;</div>
            <div class="choices" id="exam-choices"></div>
            <div class="small" id="exam-progress" style="margin-top:8px"></div>
          </div>
          <div id="exam-summary" class="hidden" style="margin-top:12px"></div>
        </div>
      </section>

      <aside class="card">
        <h3 style="margin-top:0">Zestaw s≈Ç√≥w (niemiecki magazyn/logistyka)</h3>
        <div id="tags"></div>
        <div id="list" style="max-height:240px;overflow:auto;border:1px solid var(--border-soft);border-radius:12px;padding:8px;margin-top:10px"></div>

        <h3>Dodaj w≈Çasne s≈Çowo <span class="small">(max 5)</span></h3>
        <div class="row">
          <input id="add-en" type="text" placeholder="niemiecki: np. die Palette" />
          <input id="add-pl" type="text" placeholder="polski: np. paleta" />
        </div>
        <div class="row" style="margin-top:8px">
          <input id="add-note" type="text" placeholder="notatka lub zdanie (opcjonalnie)" />
          <button id="add-btn" class="accent">Dodaj</button>
        </div>
        <div class="small" id="custom-info">Dodane: <span id="custom-count">0</span>/5</div>

        <div class="section-title">Statystyki (ostatnie 7 dni)</div>
        <div class="summary" id="stats"></div>
        <footer>Wskaz√≥wka: kliknij s≈Çowo na li≈õcie, aby oznaczyƒá/odznaczyƒá jako nauczone.</footer>
      </aside>
    </div>
  </main>

  <!-- Motyw + Fullscreen (osobny skrypt, odporny na b≈Çƒôdy w module g≈Ç√≥wnym) -->
  <script>
    const THEME_KEY = "tool_theme_v1";

    function applyTheme(theme){
      if(theme === "light"){
        document.body.classList.add("theme-light");
        setThemeColor("#ffffff");
      } else {
        document.body.classList.remove("theme-light");
        setThemeColor("#0b1220");
      }
      // od≈õwie≈º radio
      const light = document.getElementById('theme-light');
      const dark  = document.getElementById('theme-dark');
      if(light && dark){ light.checked = theme==="light"; dark.checked = theme!=="light"; }
    }
    function setThemeColor(hex){
      const meta = document.querySelector('meta[name="theme-color"]');
      if(meta) meta.setAttribute('content', hex);
    }
    function loadTheme(){ try{ return localStorage.getItem(THEME_KEY) || "dark"; }catch(e){ return "dark"; } }
    function saveTheme(t){ try{ localStorage.setItem(THEME_KEY, t); }catch(e){} }

    document.addEventListener('DOMContentLoaded', ()=>{
      // Ustaw motyw z pamiƒôci
      applyTheme(loadTheme());

      // Obs≈Çuga prze≈ÇƒÖcznika
      document.getElementById('theme-light').addEventListener('change', ()=>{ applyTheme('light'); saveTheme('light'); });
      document.getElementById('theme-dark').addEventListener('change', ()=>{ applyTheme('dark');  saveTheme('dark');  });

      // Fullscreen toggle + etykieta
      const fsBtn = document.getElementById('fullscreen');
      function syncFsButton(){ fsBtn.textContent = document.fullscreenElement ? 'Wyj≈õcie z pe≈Çnego ekranu' : 'Pe≈Çny ekran'; }
      fsBtn.addEventListener('click', async ()=>{
        try{
          if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); }
          else { await document.exitFullscreen(); }
        }catch(e){ alert('PrzeglƒÖdarka zablokowa≈Ça pe≈Çny ekran.'); }
        syncFsButton();
      });
      document.addEventListener('fullscreenchange', syncFsButton);
      syncFsButton();
    });
  </script>

  <script defer>
    // ====== ZESTAW: 50 s≈Ç√≥w DE-PL + 30 zda≈Ñ ======
    // Uwaga: struktura 'en' przechowuje tu niemieckie has≈Ço/zdanie (dla zgodno≈õci z logikƒÖ aplikacji).
    const seed = [
      // Narzƒôdzia i materia≈Çy
      { en:"das Klebeband", pl:"ta≈õma klejƒÖca", tag:"tools" },
      { en:"der Marker", pl:"marker", tag:"tools" },
      { en:"das Cuttermesser", pl:"no≈ºyk do karton√≥w", tag:"tools" },
      { en:"die Klinge", pl:"ostrze", tag:"tools" },
      { en:"die Ersatzklingen", pl:"zapasowe ostrza", tag:"tools" },
      { en:"der Abroller", pl:"dyspenser do ta≈õmy", tag:"tools" },
      { en:"die Folie", pl:"folia", tag:"tools" },
      { en:"die Stretchfolie", pl:"folia stretch", tag:"tools" },
      { en:"die Etikette", pl:"etykieta", tag:"tools" },
      { en:"der Stift", pl:"d≈Çugopis", tag:"tools" },

      // Opakowania i jednostki ≈Çadunkowe
      { en:"die Kiste", pl:"skrzynia", tag:"packaging" },
      { en:"der Karton", pl:"karton", tag:"packaging" },
      { en:"die Palette", pl:"paleta", tag:"packaging" },
      { en:"die geschlossene Palette", pl:"zamkniƒôta paleta", tag:"packaging" },
      { en:"die verpackte Palette", pl:"zapakowana paleta", tag:"packaging" },
      { en:"die gesicherte Palette", pl:"zabezpieczona paleta", tag:"packaging" },
      { en:"die besch√§digte Palette", pl:"uszkodzona paleta", tag:"packaging" },
      { en:"die Ladeeinheit", pl:"jednostka ≈Çadunkowa", tag:"packaging" },
      { en:"die Umverpackung", pl:"opakowanie zbiorcze", tag:"packaging" },
      { en:"die Charge", pl:"partia", tag:"packaging" },

      // Sprzƒôt magazynowy
      { en:"der Gabelstapler", pl:"w√≥zek wid≈Çowy", tag:"equipment" },
      { en:"der Handhubwagen (Ameise)", pl:"paleciak rƒôczny", tag:"equipment" },
      { en:"der Schubmaststapler", pl:"w√≥zek reach truck", tag:"equipment" },
      { en:"die Hebeb√ºhne", pl:"podno≈õnik", tag:"equipment" },
      { en:"das F√∂rderband", pl:"ta≈õmociƒÖg", tag:"equipment" },
      { en:"die Waage", pl:"waga", tag:"equipment" },
      { en:"der Scanner", pl:"skaner", tag:"equipment" },
      { en:"das Hochregal", pl:"rega≈Ç wysokiego sk≈Çadowania", tag:"equipment" },
      { en:"der Gang", pl:"korytarz", tag:"equipment" },
      { en:"die Rampe", pl:"rampa", tag:"equipment" },

      // Dokumenty i dane
      { en:"der Lieferschein", pl:"list przewozowy", tag:"documents" },
      { en:"die Rechnung", pl:"faktura", tag:"documents" },
      { en:"die Bestellung", pl:"zam√≥wienie", tag:"documents" },
      { en:"die Artikelnummer", pl:"numer artyku≈Çu", tag:"documents" },
      { en:"die Seriennummer", pl:"numer seryjny", tag:"documents" },
      { en:"die Menge", pl:"ilo≈õƒá", tag:"documents" },
      { en:"das Haltbarkeitsdatum (MHD)", pl:"data wa≈ºno≈õci", tag:"documents" },
      { en:"das Nettogewicht", pl:"waga netto", tag:"documents" },
      { en:"das Bruttogewicht", pl:"waga brutto", tag:"documents" },
      { en:"das Volumen", pl:"objƒôto≈õƒá", tag:"documents" },

      // BHP i organizacja
      { en:"die Warnweste", pl:"kamizelka odblaskowa", tag:"safety" },
      { en:"die Sicherheitsschuhe", pl:"buty ochronne", tag:"safety" },
      { en:"die Schutzbrille", pl:"okulary ochronne", tag:"safety" },
      { en:"die Handschuhe", pl:"rƒôkawice", tag:"safety" },
      { en:"die Unterweisung", pl:"szkolenie BHP", tag:"safety" },
      { en:"die Fluchtwege", pl:"drogi ewakuacyjne", tag:"safety" },
      { en:"die Schicht", pl:"zmiana", tag:"safety" },
      { en:"die √úberstunden", pl:"nadgodziny", tag:"safety" },
      { en:"die Pause", pl:"przerwa", tag:"safety" },
      { en:"der Auftrag", pl:"zlecenie", tag:"safety" },

      // ===== 30 zda≈Ñ (tag: sentences) =====
      { en:"Die Lieferung ist um neun Uhr angekommen.", pl:"Dostawa przyjecha≈Ça o dziewiƒÖtej.", tag:"sentences" },
      { en:"Bitte pr√ºfen Sie den Lieferschein und die Menge.", pl:"Proszƒô sprawdziƒá list przewozowy i ilo≈õƒá.", tag:"sentences" },
      { en:"Die Ware ist unbesch√§digt und vollst√§ndig.", pl:"Towar jest nienaruszony i kompletny.", tag:"sentences" },
      { en:"Hier fehlt eine Palette.", pl:"Brakuje tutaj jednej palety.", tag:"sentences" },
      { en:"Wir buchen den Wareneingang im System.", pl:"Ksiƒôgujemy przyjƒôcie w systemie.", tag:"sentences" },
      { en:"Lagere die Kartons im Hochregal, Reihe B, Platz 12.", pl:"Od≈Ç√≥≈º kartony do rega≈Çu wysokiego, rzƒÖd B, miejsce 12.", tag:"sentences" },
      { en:"Achte auf das zul√§ssige Maximalgewicht.", pl:"Zwr√≥ƒá uwagƒô na dopuszczalnƒÖ maksymalnƒÖ wagƒô.", tag:"sentences" },
      { en:"Benutze f√ºr diese Last den Schubmaststapler.", pl:"Do tego ≈Çadunku u≈ºyj reach trucka.", tag:"sentences" },
      { en:"Stell die Palette auf die Rampe.", pl:"Postaw paletƒô na rampie.", tag:"sentences" },
      { en:"Hol bitte die Palette vom Warenausgang.", pl:"Przywie≈∫ proszƒô paletƒô ze strefy wyda≈Ñ.", tag:"sentences" },
      { en:"Kommissioniere f√ºnf St√ºck nach Auftrag 1034.", pl:"Skompletuj piƒôƒá sztuk do zlecenia 1034.", tag:"sentences" },
      { en:"Scanne jede Artikelnummer vor dem Entnehmen.", pl:"Skanuj ka≈ºdy numer artyku≈Çu przed pobraniem.", tag:"sentences" },
      { en:"Lege die Ware in die Kiste mit dem gr√ºnen Label.", pl:"W≈Ç√≥≈º towar do skrzyni z zielonƒÖ etykietƒÖ.", tag:"sentences" },
      { en:"Bitte verpacke sto√üfest und f√ºlle den Leerraum mit Papier.", pl:"Zapakuj amortyzujƒÖco i wype≈Çnij puste przestrzenie papierem.", tag:"sentences" },
      { en:"Das Bruttogewicht steht auf dem Etikett.", pl:"Waga brutto jest na etykiecie.", tag:"sentences" },
      { en:"Die Sendung muss heute bis sechzehn Uhr raus.", pl:"Przesy≈Çka musi wyj≈õƒá dzi≈õ do szesnastej.", tag:"sentences" },
      { en:"Der Spediteur wartet an der Ladezone.", pl:"Przewo≈∫nik czeka w strefie za≈Çadunku.", tag:"sentences" },
      { en:"Bitte sichere die Palette mit Klebeband.", pl:"Proszƒô zabezpiecz paletƒô ta≈õmƒÖ klejƒÖcƒÖ.", tag:"sentences" },
      { en:"Die Palette ist fertig zum Abholen.", pl:"Paleta jest gotowa do odebrania.", tag:"sentences" },
      { en:"Verwende den Marker, um die Kiste zu beschriften.", pl:"U≈ºyj markera, ≈ºeby opisaƒá skrzyniƒô.", tag:"sentences" },
      { en:"Kannst du mir bitte die Palette in Reihe C bringen?", pl:"Mo≈ºesz mi proszƒô podstawiƒá paletƒô do rzƒôdu C?", tag:"sentences" },
      { en:"Heb die Palette vorsichtig an, sie ist instabil.", pl:"Podnie≈õ paletƒô ostro≈ºnie, jest niestabilna.", tag:"sentences" },
      { en:"Fahr bitte langsam, der Gang ist eng.", pl:"Jed≈∫ proszƒô powoli, korytarz jest wƒÖski.", tag:"sentences" },
      { en:"Die Palette ist schon geschlossen.", pl:"Paleta jest ju≈º zamkniƒôta.", tag:"sentences" },
      { en:"Hast du noch Ersatzklingen f√ºr das Cuttermesser?", pl:"Masz jeszcze zapasowe ostrza do no≈ºyka?", tag:"sentences" },
      { en:"Wir f√ºhren heute eine Stichprobenpr√ºfung durch.", pl:"Dzi≈õ robimy kontrolƒô wyrywkowƒÖ.", tag:"sentences" },
      { en:"Bitte z√§hle den Bestand im Regal C vollst√§ndig.", pl:"Proszƒô policz stan w regale C w ca≈Ço≈õci.", tag:"sentences" },
      { en:"Es gibt eine Abweichung zwischen System und Realit√§t.", pl:"Jest odchy≈Çka miƒôdzy systemem a rzeczywisto≈õciƒÖ.", tag:"sentences" },
      { en:"Buchen wir die Differenz nach.", pl:"Zaksiƒôgujmy r√≥≈ºnicƒô.", tag:"sentences" },
      { en:"Melde jede Besch√§digung sofort der Schichtleitung.", pl:"Zg≈Ço≈õ ka≈ºde uszkodzenie kierownikowi zmiany.", tag:"sentences" }
    ];

    // ====== LocalStorage: dedykowane klucze dla DE ======
    const LS_KEY   = "de_words_v1";
    const LS_PREV  = "de_words_prev_v0";
    const LS_STATS = "de_stats_v1";
    const LS_DAILY = "de_daily_v1";
    const LS_PREFS = "de_prefs_v1";
    const CUSTOM_LIMIT = 5;

    // Preferencje (kierunek, widoczno≈õƒá zda≈Ñ)
    let prefs = JSON.parse(localStorage.getItem(LS_PREFS) || '{"direction":"EN2PL","showExample":false}');
    function savePrefs(){ localStorage.setItem(LS_PREFS, JSON.stringify({direction, showExample})); }

    function mergeOldIntoSeed(oldArr){
      if(!Array.isArray(oldArr)) return seed.map(w=>({...w, known:false}));
      const key = s => `${(s.en||'').toLowerCase()}__${(s.pl||'').toLowerCase()}`;
      const map = new Map(seed.map(x=>[key(x), {...x, known:false}])); /* (fix) poprawna sk≈Çadnia */
      oldArr.forEach(x=>{
        const k = key(x);
        if(map.has(k)){ const base = map.get(k); map.set(k, {...base, known: !!x.known}); }
        else { map.set(k, {...x, known: !!x.known}); }
      });
      return [...map.values()];
    }

    function loadData(){
      const saved = JSON.parse(localStorage.getItem(LS_KEY) || "null");
      if(saved && Array.isArray(saved)) return saved;
      const old = JSON.parse(localStorage.getItem(LS_PREV) || "null");
      const merged = mergeOldIntoSeed(old);
      localStorage.setItem(LS_KEY, JSON.stringify(merged));
      return merged;
    }

    function saveData(data){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }
    function loadStats(){ return JSON.parse(localStorage.getItem(LS_STATS) || "{}") }
    function saveStats(s){ localStorage.setItem(LS_STATS, JSON.stringify(s)) }
    function loadDaily(){ return JSON.parse(localStorage.getItem(LS_DAILY) || "{}") }
    function saveDaily(d){ localStorage.setItem(LS_DAILY, JSON.stringify(d)) }

    let data = loadData();
    let stats = loadStats();
    let daily = loadDaily();

    let mode = "flash";                 // flash | quiz | exam
    let direction = prefs.direction || "EN2PL";   // DE‚ÜíPL (wewnƒôtrznie u≈ºywamy EN2PL dla zgodno≈õci)
    let cursor = 0;
    let showExample = !!prefs.showExample;

    // Helpers
    const $ = sel => document.querySelector(sel);
    const listEl = $("#list");
    const tagsEl = $("#tags");

    function todayKey(){ const d = new Date(); return d.toISOString().slice(0,10); }
    function incDaily(key){
      const k = todayKey();
      daily[k] = daily[k] || {learned:0, correct:0};
      daily[k][key] = (daily[k][key]||0)+1;
      saveDaily(daily);
      renderDailyStats();
    }

    function renderList(filterTag=null){
      const items = data
        .filter(w => !filterTag || w.tag===filterTag)
        .sort((a,b)=> a.en.localeCompare(b.en));
      listEl.innerHTML = items.map((w)=>{
        const idx = data.indexOf(w);
        return `<div class="tag" data-idx="${idx}" title="Kliknij, aby prze≈ÇƒÖczyƒá status">${w.known?"‚úÖ":"‚¨ú"} ${w.en} ‚Äî ${w.pl}</div>`
      }).join("");
    }

    function renderTags(){
      const tags = [...new Set(data.map(w=>w.tag))];
      tagsEl.innerHTML = ['<span class="tag" data-tag="*">Wszystkie</span>']
        .concat(tags.map(t=>`<span class="tag" data-tag="${t}">${t}</span>`)).join("");
    }

    function updateKPI(){
      const known = data.filter(w=>w.known).length;
      $("#stat-known").textContent = known;
      $("#stat-left").textContent = data.length - known;
      const acc = stats.correct && stats.total ? Math.round(100*stats.correct/stats.total) : 0;
      $("#stat-acc").textContent = acc + "%";
      const k = todayKey();
      const today = daily[k] || {learned:0, correct:0};
      $("#stat-today").textContent = today.learned + today.correct;
      $("#stat-week").textContent = sumLastNDays(7);
      updateCustomCounter();
    }

    function sumLastNDays(n){
      const now = new Date();
      let sum = 0;
      for(let i=0;i<n;i++){
        const d = new Date(now); d.setDate(now.getDate()-i);
        const k = d.toISOString().slice(0,10);
        const day = daily[k];
        if(day) sum += (day.learned||0) + (day.correct||0);
      }
      return sum;
    }

    function renderDailyStats(){
      const now = new Date();
      let rows = `<table class="table"><thead><tr><th>Dzie≈Ñ</th><th>Nauczone</th><th>Poprawne</th><th>Suma</th></tr></thead><tbody>`;
      for(let i=6;i>=0;i--){
        const d = new Date(now); d.setDate(now.getDate()-i);
        const k = d.toISOString().slice(0,10);
        const day = daily[k] || {learned:0, correct:0};
        rows += `<tr><td>${k}</td><td>${day.learned||0}</td><td>${day.correct||0}</td><td>${(day.learned||0)+(day.correct||0)}</td></tr>`;
      }
      rows += `</tbody></table>`;
      $("#stats").innerHTML = rows;
    }

    // Kierunek
    function setDirection(dir){
      direction = dir;
      savePrefs();
      if(mode==='flash') renderCard();
    }

    // Zdanie / wskaz√≥wka
    function renderExample(w){
      const el = $("#card-example");
      if(!w || !showExample){ el.textContent = ""; return; }
      if(w.exEN && w.exPL){
        el.textContent = (direction==="PL2EN"? `${w.exPL} ‚Üí ${w.exEN}` : `${w.exEN} ‚Üí ${w.exPL}`);
      } else if(w.tag === "sentences"){
        el.textContent = "ƒÜwicz ca≈Çe zdanie ‚Äì zwr√≥ƒá uwagƒô na szyk i przyimki.";
      } else {
        el.textContent = "Brak przyk≈Çadowego zdania.";
      }
    }
    function updateSentenceButton(){
      const btn = $("#toggle-sentence");
      if(btn) btn.textContent = showExample ? "Ukryj wskaz√≥wkƒô" : "Poka≈º wskaz√≥wkƒô";
    }

    // FISZKI
    function nextIndex(){
      const pool = data.filter(w=>!w.known);
      if(pool.length===0){ cursor = -1; return; }
      const idx = Math.floor(Math.random()*pool.length);
      cursor = data.indexOf(pool[idx]);
    }

    function showFlash(){
      mode = "flash";
      $("#flashcards").classList.remove("hidden");
      $("#quiz").classList.add("hidden");
      $("#exam").classList.add("hidden");
      nextIndex();
      renderCard();
    }

    function displayPrompt(w){
      if(direction==="PL2EN") return w.pl;     // PL ‚Üí DE
      if(direction==="MIX") return Math.random()<0.5? w.en : w.pl;
      return w.en; // DE ‚Üí PL
    }
    function displayAnswer(w, prompt){
      return (prompt===w.en)? w.pl : w.en;
    }

    function renderCard(){
      const wordEl = $("#card-word");
      const transEl = $("#card-translation");
      if(cursor===-1){
        wordEl.textContent = "üéâ Wszystko nauczone!";
        transEl.innerHTML = "";
        $("#card-example").innerHTML = "";
        return;
      }
      const w = data[cursor];
      const prompt = displayPrompt(w);
      wordEl.textContent = prompt;
      transEl.innerHTML = "&nbsp;";
      renderExample(w);
    }

    // QUIZ
    function showQuiz(){
      mode = "quiz";
      $("#flashcards").classList.add("hidden");
      $("#quiz").classList.remove("hidden");
      $("#exam").classList.add("hidden");
      ask();
    }

    function makeQuestion(){
      const pool = data.slice();
      const q = pool[Math.floor(Math.random()*pool.length)];
      const prompt = direction==="MIX" ? (Math.random()<0.5? q.en : q.pl) : (direction==="PL2EN"? q.pl : q.en);
      const wrongs = pool.filter(w=>w!==q).sort(()=>Math.random()-0.5).slice(0,3);
      const correctText = (prompt===q.en)? q.pl : q.en;
      const optionsTexts = [correctText, ...wrongs.map(w => (prompt===q.en? w.pl : w.en))].sort(()=>Math.random()-0.5);
      return {q, prompt, optionsTexts, correctText};
    }

    function ask(){
      const {q, prompt, optionsTexts, correctText} = makeQuestion();
      $("#quiz-q").textContent = (prompt===q.en) ? `Co znaczy: ‚Äû${q.en}‚Äù?` : `Jak po niemiecku: ‚Äû${q.pl}‚Äù?`;
      const box = $("#quiz-choices"); box.innerHTML = "";
      $("#quiz-feedback").textContent = "";
      optionsTexts.forEach(text=>{
        const div = document.createElement('div');
        div.className = 'choice';
        div.textContent = text;
        div.onclick = ()=>{
          stats.total = (stats.total||0)+1;
          if(text===correctText){
            div.classList.add('correct');
            $("#quiz-feedback").textContent = "Dobrze!";
            stats.correct = (stats.correct||0)+1;
            incDaily('correct');
          } else {
            div.classList.add('wrong');
            $("#quiz-feedback").textContent = `≈πle. Poprawnie: ${correctText}`;
          }
          saveStats(stats); updateKPI();
          setTimeout(ask, 800);
        };
        box.appendChild(div);
      });
    }

    // EXAM
    let examState = null;
    function startExam(){
      const count = Math.max(5, Math.min(50, parseInt($("#exam-count").value||10)));
      const dir = $("#exam-direction").value;
      const qs = [];
      for(let i=0;i<count;i++){
        const pool = data.slice();
        const q = pool[Math.floor(Math.random()*pool.length)];
        const prompt = dir==="MIX" ? (Math.random()<0.5? q.en : q.pl) : (dir==="PL2EN"? q.pl : q.en);
        const wrongs = pool.filter(w=>w!==q).sort(()=>Math.random()-0.5).slice(0,3);
        const correctText = (prompt===q.en)? q.pl : q.en;
        const optionsTexts = [correctText, ...wrongs.map(w => (prompt===q.en? w.pl : w.en))].sort(()=>Math.random()-0.5);
        qs.push({q, prompt, optionsTexts, correctText, answer:null});
      }
      examState = {dir, idx:0, qs, correct:0};
      $("#exam-area").classList.remove('hidden');
      $("#exam-cancel").classList.remove('hidden');
      $("#exam-summary").classList.add('hidden');
      renderExam();
    }

    function renderExam(){
      const st = examState; if(!st) return;
      const item = st.qs[st.idx];
      $("#exam-q").textContent = (item.prompt===item.q.en) ? `Co znaczy: ‚Äû${item.q.en}‚Äù?` : `Jak po niemiecku: ‚Äû${item.q.pl}‚Äù?`;
      $("#exam-progress").textContent = `Pytanie ${st.idx+1}/${st.qs.length}`;
      const box = $("#exam-choices"); box.innerHTML = "";
      item.optionsTexts.forEach(text=>{
        const div = document.createElement('div');
        div.className = 'choice';
        div.textContent = text;
        div.onclick = ()=>{
          item.answer = text;
          if(text===item.correctText){ st.correct++; incDaily('correct'); }
          if(st.idx < st.qs.length-1){ st.idx++; renderExam(); }
          else { finishExam(); }
        };
        box.appendChild(div);
      });
    }

    function finishExam(){
      const st = examState; if(!st) return;
      $("#exam-area").classList.add('hidden');
      $("#exam-cancel").classList.add('hidden');
      const score = Math.round(100*st.correct/st.qs.length);
      let html = `<div class="summary"><div class="big">Wynik: ${st.correct}/${st.qs.length} (${score}%)</div>`;
      html += `<div class="section-title">PrzeglƒÖd odpowiedzi</div>`;
      html += `<table class="table"><thead><tr><th>Pytanie</th><th>Twoja odp.</th><th>Poprawna</th><th>Tag</th></tr></thead><tbody>`;
      st.qs.forEach(it=>{
        const ok = it.answer===it.correctText;
        html += `<tr><td>${it.prompt}</td><td style="color:${ok?'#2ecc71':'#e74c3c'}">${it.answer||'-'}</td><td>${it.correctText}</td><td>${it.q.tag||''}</td></tr>`;
      });
      html += `</tbody></table></div>`;
      $("#exam-summary").innerHTML = html;
      $("#exam-summary").classList.remove('hidden');
      examState = null;
    }

    // DODATKOWE: licznik s≈Ç√≥w w≈Çasnych i limit
    function countCustom(){ return data.filter(w=>w.tag==='custom').length; }
    function updateCustomCounter(){
      const c = countCustom();
      const span = $("#custom-count");
      if(span) span.textContent = c;
      const btn = $("#add-btn");
      if(btn) btn.disabled = c >= CUSTOM_LIMIT;
    }

    // Zdarzenia
    document.addEventListener('click', (e)=>{
      const tag = e.target.getAttribute('data-tag');
      if(tag){ renderList(tag==='*'?null:tag); }

      if(e.target.matches('#show-translation')){
        if(cursor!==-1){
          const w = data[cursor];
          const prompt = $("#card-word").textContent;
          $("#card-translation").textContent = displayAnswer(w, prompt);
        }
      }

      if(e.target.matches('#toggle-sentence')){
        if(cursor!==-1){
          showExample = !showExample;
          savePrefs();
          updateSentenceButton();
          renderExample(data[cursor]);
        }
      }

      if(e.target.matches('#mark-known')){
        if(cursor!==-1){
          data[cursor].known = true;
          saveData(data); updateKPI(); incDaily('learned');
          nextIndex(); renderCard(); renderList();
        }
      }
      if(e.target.matches('#mode-flash')) showFlash();
      if(e.target.matches('#mode-quiz')) showQuiz();
      if(e.target.matches('#mode-exam')){ $("#exam").classList.remove('hidden'); $("#flashcards").classList.add('hidden'); $("#quiz").classList.add('hidden'); mode='exam'; }
      if(e.target.matches('#shuffle')){ data.sort(()=>Math.random()-0.5); renderList(); if(mode==='flash') renderCard(); saveData(data); }
      if(e.target.matches('#reset')){
        if(confirm('Zerowaƒá status nauki i statystyki?')){
          data.forEach(w=>w.known=false); stats={}; daily={};
          saveData(data); saveStats(stats); saveDaily(daily);
          updateKPI(); renderList(); if(mode==='flash') renderCard(); renderDailyStats();
        }
      }
      if(e.target.closest('#list .tag')){
        const el = e.target.closest('#list .tag');
        const i = +el.dataset.idx; data[i].known = !data[i].known; saveData(data); updateKPI(); renderList();
      }
      if(e.target.matches('#exam-start')) startExam();
      if(e.target.matches('#exam-cancel')){ examState=null; $("#exam-area").classList.add('hidden'); $("#exam-cancel").classList.add('hidden'); $("#exam-summary").classList.add('hidden'); }
    });

    // Zmiana kierunku ‚Äì FIX
    document.addEventListener('change', (e)=>{
      if(e.target && e.target.id === 'direction'){
        setDirection(e.target.value);
      }
    });

    // Dodawanie w≈Çasnych s≈Ç√≥w ‚Äì z limitem 5
    $("#add-btn").onclick = ()=>{
      const current = countCustom();
      if(current >= CUSTOM_LIMIT){
        alert(`OsiƒÖgniƒôto limit ${CUSTOM_LIMIT} w≈Çasnych s≈Ç√≥w.`);
        updateCustomCounter();
        return;
      }
      const en = $("#add-en").value.trim();
      const pl = $("#add-pl").value.trim();
      const note = $("#add-note").value.trim();
      if(!en || !pl){ alert('Podaj obie wersje: niemiecki i polski.'); return; }
      const extras = note ? (note.includes(' ')? {exEN: note, exPL: ''} : {}) : {};
      data.push({en, pl, tag:'custom', known:false, ...extras});
      saveData(data); renderTags(); renderList(); updateKPI(); updateCustomCounter();
      $("#add-en").value = $("#add-pl").value = $("#add-note").value = "";
    };

    // Start
    document.getElementById('direction').value = direction;
    renderTags(); renderList(); renderDailyStats(); updateKPI(); updateSentenceButton(); showFlash();
  </script>

  <footer class="site-footer" role="contentinfo" aria-label="Informacje o autorze">
    <div class="inner">
      <div class="left">
        ¬© 2025 zolwikC ‚Äî ‚ÄûNiemiecki dla magazynu / logistyki‚Äù
      </div>
      <div class="right">
        <a href="https://github.com/zolwikC" target="_blank" rel="noopener noreferrer" aria-label="GitHub autora">
          <svg viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" d="M8 0C3.58 0 0 3.73 0 8.33c0 3.68 2.29 6.8 5.47 7.9.4.08.55-.18.55-.39 0-.19-.01-.82-.01-1.49-2.01.45-2.43-.5-2.58-.96-.09-.24-.48-.96-.82-1.15-.28-.15-.68-.52-.01-.53.63-.01 1.08.6 1.23.85.72 1.23 1.87.88 2.33.67.07-.54.28-.88.51-1.08-1.78-.2-3.64-.92-3.64-4.08 0-.9.31-1.63.82-2.21-.08-.2-.36-1.01.08-2.1 0 0 .67-.22 2.2.85.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.07 2.2-.85 2.2-.85.44 1.09.16 1.9.08 2.1.51.58.82 1.31.82 2.21 0 3.17-1.87 3.88-3.65 4.08.29.26.54.77.54 1.56 0 1.12-.01 2.02-.01 2.29 0 .21.15.47.55.39A8.33 8.33 0 0 0 16 8.33C16 3.73 12.42 0 8 0Z"/></svg>
          GitHub profil
        </a>
      </div>
    </div>
  </footer>
</body>
</html>
